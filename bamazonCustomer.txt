var mysql      = require('mysql');
var Prompt = require('prompt-checkbox');

var connection = mysql.createConnection({
  host     : 'localhost',
  user     : 'root',
  password : 'root',
  database : 'bamazon'
});
displayProducts();
function getPurchaseInfo(){
var prompt = new Prompt(
  {
  name: 'productId',
  type: 'input',
  message: 'What is the ID of the product you would like to buy?',
  },{
    name: 'units',
    type: 'input',
    message: 'How many units of the product you would like to buy?',
  }
);
// promises
prompt.run()
  .then(function(answers) {
    console.log(answers);
    var query = "Select ? from products where ?";
    connection.query(query, { item_id: answers.productId}, function(err, res){
      console.log("response" +res[0]);
      for(var i=0; i<res.length; i++){
        if(res.length == null){
          console.log("no product exists. try again..");
          displayProducts();
        }
        else{
          if(answers.units < res[0].stock_quantity){
            console("Insufficient quantity!");
            updateStock(answers.units, res[0].stock_quantity);
          }
          else console("Sufficient quantity.");
        }
      }
    });
  })
  .catch(function(err) {
    console.log(err)
  })
 
// async
prompt.ask(function(answers) {
  console.log(answers)
});
}
function updateStock(){
  connection.connect(function(err) {
    if (err) throw err;
    var sql = "UPDATE products SET" +stock_quantity+ "=" +answers.units+ WHERE item_id =" +;
    con.query(sql, function (err, result) {
      if (err) throw err;
      console.log(result.affectedRows + " record(s) updated");
    });
  });
}

function displayProducts(){
  connection.connect();
  connection.query('SELECT * from products', function (error, results, fields) {
    if (error) throw error;
    console.log('The solution is: ', results[0].solution);
});
connection.end();
getPurchaseInfo();
}